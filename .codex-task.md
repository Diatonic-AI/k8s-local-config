# K8s Repository Bootstrap Task for Codex Agent

## Mission
Bootstrap the `/home/daclab-ai/k8s-local-config` repository into a production-ready GitHub repository for the Diatonic AI organization with complete documentation, CI/CD, and governance files.

## Context
- **Repository**: `/home/daclab-ai/k8s-local-config`
- **GitHub Org**: `diatonic-ai`
- **Repository Name**: `k8s-local-config`
- **Existing Content**: 96 Kubernetes manifest files for Llama 3 8B deployment with multi-adapter support
- **Primary Components**: LLM deployments, GPU time-slicing, Qdrant vector DB, certificate management, TLS ingress

## Tasks

### 1. Analyze Existing Manifests
**Objective**: Understand what K8s resources already exist

```bash
# Find all YAML files
find k8s-manifests -type f \( -name "*.yaml" -o -name "*.yml" \) | wc -l

# List directory structure
tree -L 3 k8s-manifests

# Identify key resource types
find k8s-manifests -name "*.yaml" -exec grep -h "^kind:" {} \; | sort | uniq -c | sort -rn
```

**Output**: Create `reports/manifest-analysis.md` with:
- Count of YAML files
- Directory structure
- Resource type distribution (Deployment, Service, ConfigMap, etc.)
- Key components identified

### 2. Initialize Git Repository
**Objective**: Set up Git with proper configuration

```bash
cd /home/daclab-ai/k8s-local-config

# Initialize if not done
if [[ ! -d .git ]]; then
    git init
    git config user.name "Diatonic AI Automation"
    git config user.email "engineering@diatonic.ai"
fi

# Check status
git status
```

### 3. Create GitHub Workflows
**Objective**: Set up CI/CD for manifest validation

Create `.github/workflows/ci.yaml`:
```yaml
name: CI

on:
  push:
    branches: [ main, feature/**, fix/** ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      
      - name: Install yamllint
        run: pip install yamllint
      
      - name: Lint YAML
        run: yamllint -c .yamllint.yaml .
      
      - name: Install kubeconform
        run: |
          curl -sSL https://github.com/yannh/kubeconform/releases/download/v0.6.7/kubeconform-linux-amd64.tar.gz | tar -xz
          sudo mv kubeconform /usr/local/bin/
      
      - name: Validate manifests
        run: |
          find k8s-manifests -name "*.yaml" -o -name "*.yml" | xargs kubeconform -summary -verbose
```

### 4. Create GitHub Issue Templates
Create `.github/ISSUE_TEMPLATE/bug_report.yml`:
```yaml
name: Bug Report
description: File a bug report
title: "[Bug]: "
labels: ["bug", "triage"]
body:
  - type: markdown
    attributes:
      value: |
        Thanks for reporting a bug!
  
  - type: textarea
    id: what-happened
    attributes:
      label: What happened?
      description: Describe the bug
    validations:
      required: true
  
  - type: textarea
    id: manifests
    attributes:
      label: Related Manifests
      description: Which manifests are affected?
      placeholder: |
        k8s-manifests/llama3-8b-deployment/...
```

Create `.github/ISSUE_TEMPLATE/feature_request.yml` similarly.

### 5. Create Documentation Structure
Create `docs/` directory with:

**docs/ARCHITECTURE.md**:
```markdown
# Architecture Overview

## Purpose
Kubernetes manifests for Diatonic AI infrastructure deployments.

## Key Components

### LLM Deployment (Llama 3 8B)
- Multi-adapter architecture
- GPU time-slicing for efficient resource utilization
- Adapters: chatbot, code, RAG, microservices

### Vector Database
- Qdrant for semantic search and embeddings

### Infrastructure
- Certificate management (cert-manager)
- TLS ingress configuration
- Persistent storage

## Deployment Environments
- Local: Development and testing
- Dev: Integration testing
- Staging: Pre-production validation
- Production: Live deployments
```

**docs/SETUP.md**:
```markdown
# Setup Guide

## Prerequisites
- kubectl (v1.28+)
- Access to Kubernetes cluster
- yamllint, kubeconform for validation

## Local Validation
\```bash
yamllint -c .yamllint.yaml .
kubeconform -summary k8s-manifests/**/*.yaml
\```

## Apply Manifests
\```bash
# Certificate manager first
kubectl apply -f k8s-manifests/certificate-manager/

# Then application manifests
kubectl apply -f k8s-manifests/llama3-8b-deployment/
\```
```

### 6. Create Additional Governance Files

**Create `.github/CODEOWNERS`**:
```
# Platform team owns all manifests
* @diatonic-ai/platform-team

# Specific ownership for LLM deployments
/k8s-manifests/llama3-8b-deployment/ @diatonic-ai/ml-team
```

**Create `.github/dependabot.yml`**:
```yaml
version: 2
updates:
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
```

**Create `.github/pull_request_template.md`**:
```markdown
## Summary
<!-- Describe the changes -->

## Type of Change
- [ ] New manifest
- [ ] Configuration update
- [ ] Bug fix
- [ ] Documentation

## Checklist
- [ ] yamllint passes
- [ ] kubeconform validates successfully
- [ ] Documentation updated
- [ ] Tested in dev environment (if applicable)
```

### 7. Create LICENSE File
Create Apache 2.0 license:
```
Apache License
Version 2.0, January 2004
http://www.apache.org/licenses/

[Full Apache 2.0 license text]
```

### 8. Git Operations
```bash
# Stage all files
git add -A

# Create initial commit
git commit -m "feat(repo): initialize k8s manifest repository

- Add all existing K8s manifests
- Set up CI/CD with GitHub Actions
- Add documentation (ARCHITECTURE, SETUP, README)
- Add governance files (CONTRIBUTING, SECURITY, CODE_OF_CONDUCT)
- Configure yamllint and kubeconform validation
- Add issue templates and PR template"

# Create main branch
git branch -M main
```

### 9. Create GitHub Repository
```bash
# Using gh CLI (if available)
gh repo create diatonic-ai/k8s-local-config \
    --public \
    --description "Kubernetes manifests for Diatonic AI infrastructure" \
    --source . \
    --remote origin \
    --push

# Or provide instructions for manual creation
echo "
To create the GitHub repository manually:
1. Go to https://github.com/organizations/diatonic-ai/repositories/new
2. Repository name: k8s-local-config
3. Description: Kubernetes manifests for Diatonic AI infrastructure
4. Visibility: Public
5. Do NOT initialize with README (we have one)
6. Click 'Create repository'

Then run:
git remote add origin git@github.com:diatonic-ai/k8s-local-config.git
git push -u origin main
"
```

### 10. Verification
```bash
# Verify all required files exist
required_files=(
    ".gitignore"
    ".gitattributes"
    ".yamllint.yaml"
    "README.md"
    "LICENSE"
    "CONTRIBUTING.md"
    "CODE_OF_CONDUCT.md"
    "SECURITY.md"
    ".github/workflows/ci.yaml"
    ".github/CODEOWNERS"
    ".github/dependabot.yml"
    "docs/ARCHITECTURE.md"
    "docs/SETUP.md"
    "reports/manifest-analysis.md"
)

for file in "${required_files[@]}"; do
    if [[ -f "$file" ]]; then
        echo "✅ $file"
    else
        echo "❌ Missing: $file"
    fi
done
```

## Success Criteria
- [ ] All governance files created (README, LICENSE, CONTRIBUTING, SECURITY, CODE_OF_CONDUCT)
- [ ] Git repository initialized with proper config
- [ ] GitHub Actions CI workflow configured
- [ ] Issue and PR templates created
- [ ] Documentation structure in place (docs/)
- [ ] Manifest analysis report generated
- [ ] All files committed to Git
- [ ] Ready to push to GitHub under diatonic-ai org

## Notes
- Do not commit any secrets or kubeconfig files
- Ensure all YAML files pass yamllint validation
- Document any deployment-specific configurations in docs/
- Follow Conventional Commits for all commit messages
